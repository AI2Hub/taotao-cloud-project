plugins {
    id "java"
    //https://plugins.gradle.org/plugin/org.jetbrains.intellij
    id "org.jetbrains.intellij" version "1.14.2"
}

apply plugin: "java"
apply plugin: "org.jetbrains.intellij"

dependencies {
    //testImplementation "junit:junit:4.13.2"

    implementation "org.dromara.hutool:hutool-all:6.0.0-M4"
    implementation "com.google.zxing:core:3.5.1"
    implementation "com.google.zxing:javase:3.5.1"
}

//version "3.2022.15"

// https://github.com/JetBrains/gradle-intellij-plugin
intellij {
    // 插件名称
    pluginName = "TaoTaoToolKit"
    //沙箱目录位置，用于保存IDEA的设置，默认在build文件下面，防止clean，放在根目录下。
    //sandboxDir = "${rootProject.rootDir}/idea-sandbox"
    //这里指定支持的IDE最小版本
    version = "2021.3"
    type = "IC"

    // 各种版本去这里找
    // https://www.jetbrains.com/intellij-repository/releases
    //Disables updating since-build attribute in plugin.xml
    // 配合这个参数，屏蔽插件安装时报的错：Plugin is not compatible with the current version of the IDE
    // updateSinceUntilBuild也可以在plugin.xml配置 <idea-version since-build="191.0"/>
    // 其中191.0表示2019.1月发布的版本，0表示无限大的版本
    updateSinceUntilBuild = false
    downloadSources = true
}

patchPluginXml {
    //changeNotes = """
    //              TaoTaoToolKit-1.0.1
    //              """
    //最低支持的版本 当前插件的起止 IDE 版本支持
    //版本参考：https://plugins.jetbrains.com/docs/intellij/build-number-ranges.html?from=jetbrains.org#intellij-platform-based-products-of-recent-ide-versions
    sinceBuild.set("213")

    //最高支持的版本，不能不设置，不设置是默认为 project.version
    untilBuild.set("223.*")
}

// https://plugins.jetbrains.com/docs/intellij/plugin-signing.html
//signPlugin {
//    certificateChain.set(System.getenv("CERTIFICATE_CHAIN"))
//    privateKey.set(System.getenv("PRIVATE_KEY"))
//    password.set(System.getenv("PRIVATE_KEY_PASSWORD"))
//}

//https://plugins.jetbrains.com/author/me
//https://plugins.jetbrains.com/docs/intellij/publishing-plugin.html
//https://plugins.jetbrains.com/plugin/20506-taotaocloudideaplugin
publishPlugin { token.set(System.getenv("IEDA_PLUGIN_PUBLISH_TOKEN")) }
