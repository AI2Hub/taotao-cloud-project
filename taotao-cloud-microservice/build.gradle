subprojects {
    apply from: rootProject.file('gradle/springboot.gradle')
    apply from: rootProject.file('gradle/smart-doc.gradle')
    apply from: rootProject.file('gradle/springdoc-openapi.gradle')
    apply from: rootProject.file('gradle/docker.gradle')
    apply from: rootProject.file('gradle/google-tools-jib.gradle')
    //apply from: rootProject.file('gradle/sonar.gradle')
    apply from: rootProject.file('gradle/shadow.gradle')
    apply from: rootProject.file('gradle/graalvm.gradle')

    tasks.register('createProperties') {
        dependsOn processResources
        doLast {
            def fileDir = new File("$buildDir/resources/main");
            if (fileDir.exists() && fileDir.isDirectory()) {
                def pro = ["application.properties", "bootstrap.properties"]
                pro.forEach(item -> {
                    new File("$buildDir/resources/main/$item").withWriter { w ->
                        def projectProperties = project.properties
                        Properties p = new Properties()
                        projectProperties.each { entry ->
                            p[entry.key.toString()] = entry.value.toString()
                        }

                        p.store w, null
                    }
                })
            }
        }
    }

    classes {
        dependsOn createProperties
    }

    dependencies {
        testImplementation "org.springframework.boot:spring-boot-starter-test"
        testImplementation "org.testcontainers:junit-jupiter"
        testImplementation 'io.projectreactor:reactor-test'
        testImplementation 'org.springframework.cloud:spring-cloud-stream-test-binder'
        testImplementation "org.springframework.boot:spring-boot-starter-web"

        //https://search.maven.org/artifact/org.jeasy/easy-random
        testImplementation 'org.jeasy:easy-random:5.0.0'
        //https://search.maven.org/artifact/com.github.javafaker/javafaker
        testImplementation('com.github.javafaker:javafaker:1.0.2') {
            exclude group: "org.yaml", module: "snakeyaml"
        }

        //https://github.com/yindz/common-random
        //https://search.maven.org/artifact/com.apifan.common/common-random/
        testImplementation "com.apifan.common:common-random:1.0.21"

        implementation "io.soabase.record-builder:record-builder-core"
        annotationProcessor "io.soabase.record-builder:record-builder-processor:${recordBuilderVersion}"

        implementation "org.projectlombok:lombok"
        annotationProcessor "org.projectlombok:lombok:${lombokVersion}"
        annotationProcessor "org.projectlombok:lombok-mapstruct-binding:${lombokMapstructBindingVersion}"

        implementation "io.soabase.record-builder:record-builder-core"
        annotationProcessor "io.soabase.record-builder:record-builder-processor:${recordBuilderVersion}"

        implementation "org.mapstruct:mapstruct"
        annotationProcessor "org.mapstruct:mapstruct-processor:${mapstructProcessorVersion}"
        //https://github.com/entur/mapstruct-spi-protobuf
        //https://search.maven.org/artifact/no.entur.mapstruct.spi/protobuf-spi-impl
        annotationProcessor "no.entur.mapstruct.spi:protobuf-spi-impl:1.44"

        annotationProcessor "org.springframework.boot:spring-boot-configuration-processor:${springBootVersion}"
    }
}
