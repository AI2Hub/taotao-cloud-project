<?xml version="1.0" encoding="UTF-8"?>
<included>
	<appender name="FILE_ALL_APPENDER" class="ch.qos.logback.core.rolling.RollingFileAppender">
		<file>${LOG_FILE}/${APP_NAME}.all.log</file>
		<append>true</append>
		<encoder class="ch.qos.logback.core.encoder.LayoutWrappingEncoder">
			<layout
				class="org.apache.skywalking.apm.toolkit.log.logback.v1.x.TraceIdPatternLogbackLayout">
				<pattern>${CONSOLE_LOG_PATTERN_NO_COLOR}</pattern>
			</layout>
		</encoder>
		<rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
			<!--文件路径,定义了日志的切分方式——把每一天的日志归档到一个文件中,以防止日志填满整个磁盘空间-->
			<fileNamePattern>
				${LOG_FILE}/history/${APP_NAME:-}.all.%d{yyyy-MM-dd}.%i.log.gz
			</fileNamePattern>
			<!--只保留最近30天的日志-->
			<MaxHistory>${LOG_FILE_MAX_DAY}</MaxHistory>
			<!--日志文件最大的大小-->
			<maxFileSize>${LOG_MAX_FILE_SIZE}</maxFileSize>
			<!--用来指定日志文件的上限大小，那么到了这个值，就会删除旧的日志-->
			<totalSizeCap>${TOTAL_SIZE_CAP}</totalSizeCap>
			<cleanHistoryOnStart>${CLEAN_HISTORY_ON_START}</cleanHistoryOnStart>
		</rollingPolicy>
	</appender>

	<appender name="FILE_WARN_APPENDER" class="ch.qos.logback.core.rolling.RollingFileAppender">
		<file>${LOG_FILE}/${APP_NAME}.warn.log</file>
		<append>true</append>
		<encoder class="ch.qos.logback.core.encoder.LayoutWrappingEncoder">
			<layout
				class="org.apache.skywalking.apm.toolkit.log.logback.v1.x.TraceIdPatternLogbackLayout">
				<pattern>${CONSOLE_LOG_PATTERN_NO_COLOR}</pattern>
			</layout>
		</encoder>
		<rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
			<fileNamePattern>
				${LOG_FILE}/history/${APP_NAME:-}.warn.%d{yyyy-MM-dd}.%i.log.gz
			</fileNamePattern>
			<MaxHistory>${LOG_FILE_MAX_DAY}</MaxHistory>
			<maxFileSize>${LOG_MAX_FILE_SIZE}</maxFileSize>
			<totalSizeCap>${TOTAL_SIZE_CAP}</totalSizeCap>
			<cleanHistoryOnStart>${CLEAN_HISTORY_ON_START}</cleanHistoryOnStart>
		</rollingPolicy>
		<filter class="ch.qos.logback.classic.filter.LevelFilter">
			<level>WARN</level>
			<!-- 如果命中就禁止这条日志 -->
			<onMatch>ACCEPT</onMatch>
			<!-- 如果没有命中就使用这条规则 -->
			<onMismatch>DENY</onMismatch>
		</filter>
	</appender>

	<appender name="FILE_ERROR_APPENDER" class="ch.qos.logback.core.rolling.RollingFileAppender">
		<file>${LOG_FILE}/${APP_NAME:-}.error.log</file>
		<append>true</append>
		<encoder class="ch.qos.logback.core.encoder.LayoutWrappingEncoder">
			<layout
				class="org.apache.skywalking.apm.toolkit.log.logback.v1.x.TraceIdPatternLogbackLayout">
				<pattern>${CONSOLE_LOG_PATTERN_NO_COLOR}</pattern>
			</layout>
		</encoder>
		<rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
			<fileNamePattern>
				${LOG_FILE}/history/${APP_NAME:-}.error.%d{yyyy-MM-dd}.%i.log.gz
			</fileNamePattern>
			<MaxHistory>${LOG_FILE_MAX_DAY}</MaxHistory>
			<maxFileSize>${LOG_MAX_FILE_SIZE}</maxFileSize>
			<totalSizeCap>${TOTAL_SIZE_CAP}</totalSizeCap>
			<cleanHistoryOnStart>${CLEAN_HISTORY_ON_START}</cleanHistoryOnStart>
		</rollingPolicy>
		<filter class="ch.qos.logback.classic.filter.LevelFilter">
			<level>ERROR</level>
			<onMatch>ACCEPT</onMatch>
			<onMismatch>DENY</onMismatch>
		</filter>
	</appender>

	<appender name="FILE_DEBUG_APPENDER" class="ch.qos.logback.core.rolling.RollingFileAppender">
		<file>${LOG_FILE}/${APP_NAME:-}.debug.log</file>
		<append>true</append>
		<encoder class="ch.qos.logback.core.encoder.LayoutWrappingEncoder">
			<layout
				class="org.apache.skywalking.apm.toolkit.log.logback.v1.x.TraceIdPatternLogbackLayout">
				<pattern>${CONSOLE_LOG_PATTERN_NO_COLOR}</pattern>
			</layout>
		</encoder>
		<rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
			<fileNamePattern>
				${LOG_FILE}/history/${APP_NAME:-}.debug.%d{yyyy-MM-dd}.%i.log.gz
			</fileNamePattern>
			<MaxHistory>${LOG_FILE_MAX_DAY}</MaxHistory>
			<maxFileSize>${LOG_MAX_FILE_SIZE}</maxFileSize>
			<totalSizeCap>${TOTAL_SIZE_CAP}</totalSizeCap>
			<cleanHistoryOnStart>${CLEAN_HISTORY_ON_START}</cleanHistoryOnStart>
		</rollingPolicy>
		<filter class="ch.qos.logback.classic.filter.LevelFilter">
			<level>DEBUG</level>
			<onMatch>ACCEPT</onMatch>
			<onMismatch>DENY</onMismatch>
		</filter>
	</appender>

	<appender name="FILE_SQL_APPENDER" class="ch.qos.logback.core.rolling.RollingFileAppender">
		<file>${LOG_FILE}/${APP_NAME:-}.sql.log</file>
		<append>true</append>
		<encoder class="ch.qos.logback.core.encoder.LayoutWrappingEncoder">
			<layout
				class="org.apache.skywalking.apm.toolkit.log.logback.v1.x.TraceIdPatternLogbackLayout">
				<pattern>${CONSOLE_LOG_PATTERN_NO_COLOR}</pattern>
			</layout>
		</encoder>
		<rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
			<fileNamePattern>
				${LOG_FILE}/history/${APP_NAME:-}.sql.%d{yyyy-MM-dd}.%i.log.gz
			</fileNamePattern>
			<MaxHistory>${LOG_FILE_MAX_DAY}</MaxHistory>
			<maxFileSize>${LOG_MAX_FILE_SIZE}</maxFileSize>
			<totalSizeCap>${TOTAL_SIZE_CAP}</totalSizeCap>
			<cleanHistoryOnStart>${CLEAN_HISTORY_ON_START}</cleanHistoryOnStart>
		</rollingPolicy>
		<!--		<filter class="ch.qos.logback.classic.filter.LevelFilter">-->
		<!--			<level>DEBUG</level>-->
		<!--			<onMatch>ACCEPT</onMatch>-->
		<!--			<onMismatch>DENY</onMismatch>-->
		<!--		</filter>-->
	</appender>

	<appender name="FILE_ALL_ASYNC_APPENDER" class="ch.qos.logback.classic.AsyncAppender">
		<!-- 更改默认的队列的深度,该值会影响性能.默认值为256 -->
		<queueSize>512</queueSize>
		<!-- 默认情况下，当阻塞队列的剩余容量为20％时，它将丢弃TRACE，DEBUG和INFO级别的事件，仅保留WARN和ERROR级别的事件。要保留所有事件，请将discardingThreshold设置为0。 -->
		<discardingThreshold>0</discardingThreshold>
		<!--提取调用者数据的代价是相当昂贵的。为了提升性能，默认情况下，当event被加入到queue时，event关联的调用者数据不会被提取。默认情况下，只有"cheap"的数据，如线程名。-->
		<includeCallerData>true</includeCallerData>

		<appender-ref ref="FILE_ALL_APPENDER"/>
	</appender>

	<appender name="FILE_WARN_ASYNC_APPENDER" class="ch.qos.logback.classic.AsyncAppender">
		<queueSize>512</queueSize>
		<discardingThreshold>0</discardingThreshold>
		<includeCallerData>true</includeCallerData>

		<appender-ref ref="FILE_WARN_APPENDER"/>
	</appender>

	<appender name="FILE_ERROR_ASYNC_APPENDER" class="ch.qos.logback.classic.AsyncAppender">
		<queueSize>512</queueSize>
		<discardingThreshold>0</discardingThreshold>
		<includeCallerData>true</includeCallerData>

		<appender-ref ref="FILE_ERROR_APPENDER"/>
	</appender>

	<appender name="FILE_DEBUG_ASYNC_APPENDER" class="ch.qos.logback.classic.AsyncAppender">
		<queueSize>512</queueSize>
		<discardingThreshold>0</discardingThreshold>
		<includeCallerData>true</includeCallerData>

		<appender-ref ref="FILE_DEBUG_APPENDER"/>
	</appender>

	<appender name="FILE_SQL_ASYNC_APPENDER" class="ch.qos.logback.classic.AsyncAppender">
		<queueSize>512</queueSize>
		<discardingThreshold>0</discardingThreshold>
		<includeCallerData>true</includeCallerData>

		<appender-ref ref="FILE_SQL_APPENDER"/>
	</appender>
</included>
