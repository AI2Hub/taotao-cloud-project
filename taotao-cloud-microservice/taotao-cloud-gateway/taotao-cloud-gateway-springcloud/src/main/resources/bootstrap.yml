server:
  port: 33333
  shutdown: graceful
  http2:
    enabled: false
  ssl:
    enabled: false
    key-store: classpath:cert/SHA256withRSA_taotaocloud.top.jks
    key-store-type: JKS
    key-store-password: 1234

spring:
  main:
    allow-bean-definition-overriding: true
    web-application-type: reactive
    banner-mode: off
  application:
    name: taotao-cloud-gateway-springcloud
  cloud:
    loadbalancer:
      enabled: true
      configurations: polaris
    tencent:
      plugin:
        scg:
          staining:
            enabled: true
            rule-staining:
              enabled: true
        router:
          feature-env:
            enabled: true
      metadata:
        content:
          taotao: 1
          env: blue
        transitive:
          - aaaa
          - bbbb
      rpc-enhancement:
        enabled: true
        reporter:
          ignore-internal-server-error: true
          series: server_error
          statuses: gateway_timeout, bad_gateway, service_unavailable
    polaris:
      address: grpc://192.168.10.210:8091
      namespace: default
      enabled: true
      ratelimit:
        enabled: true
        rejectRequestTipsFilePath: reject-tips.html
        maxQueuingTime: 500
      circuitbreaker:
        enabled: true
      stat:
        enabled: true
        port: 28081
      config:
        address: grpc://192.168.10.210:8093 # the address of polaris config server
        auto-refresh: true # auto refresh when config file changed
        groups:
          - name: ${spring.application.name} # group name
            files: [ "config/application.properties", "config/bootstrap.yml" ] # config/application.properties takes precedence over config/bootstrap.yml
    gateway:
      discovery:
        locator:
          enabled: true
          'predicates[0]':
            name: Path
            args:
              patterns: '''/'' + serviceId + ''/**'''
          'filters[0]':
            name: RewritePath
            args:
              regexp: '''/'' + serviceId + ''/(?<remaining>.*)'''
              replacement: '''/$\{remaining}'''
          'filters[1]':
            name: Retry
            args:
              retries: 3
              exceptions:
                '[0]': '''java.net.ConnectException'''
                '[1]': '''java.io.IOException'''
              statuses:
                '[0]': '''BAD_GATEWAY'''
                '[1]': '''SERVICE_UNAVAILABLE'''
              series:
                '[0]': '''CLIENT_ERROR'''
              methods:
                '[0]': '''GET'''
                '[1]': '''POST'''
                '[2]': '''PUT'''
                '[3]': '''DELETE'''
              backoff:
                firstBackoff: '''100ms'''
                maxBackoff: '''500ms'''
                factor: 2
                basedOnPreviousValue: false
      routes:
        - id: GatewayCalleeService
          uri: lb://GatewayCalleeService
          predicates:
            - Path=/GatewayCalleeService/**
          filters:
            - StripPrefix=1
    #------------------------------------------
    nacos:
      discovery:
        server-addr: 192.168.10.210:8848
        metadata:
          version: ${taotaoCloudVersion}
          user.name: "admin"
          user.password: "123456"
        group: TAOTAO_CLOUD_GROUP
        namespace: taotao-cloud-dev
        username: nacos
        password: nacos
        cluster-name: CQ
        naming-load-cache-at-start: false
      config:
        enabled: true
        server-addr: 192.168.10.210:8848
        namespace: taotao-cloud-dev
        file-extension: yml
        cluster-name: CQ
        group: TAOTAO_CLOUD_GROUP
        username: nacos
        password: nacos
        refresh-enabled: true
    sentinel:
      enabled: true
      eager: true
      datasource:
        #流控 名称随意
        flow:
          nacos:
            server-addr: 192.168.10.210:8848
            dataId: ${spring.application.name}-flow-rules
            namespace: taotao-cloud-sentinel
            username: nacos
            password: nacos
            groupId: SENTINEL_GROUP
            data-type: json
            # 规则类型，取值见： org.springframework.cloud.alibaba.sentinel.datasource.RuleType
            rule-type: flow
        #熔断降级 名称随意
        degrade:
          nacos:
            server-addr: 192.168.10.210:8848
            dataId: ${spring.application.name}-degrade-rules
            namespace: taotao-cloud-sentinel
            username: nacos
            password: nacos
            groupId: SENTINEL_GROUP
            data-type: json
            rule-type: degrade
        #系统规则 名称随意
        system:
          nacos:
            server-addr: 192.168.10.210:8848
            dataId: ${spring.application.name}-system-rules
            namespace: taotao-cloud-sentinel
            username: nacos
            password: nacos
            groupId: SENTINEL_GROUP
            data-type: json
            rule-type: system
        #授权规则 名称随意
        authority:
          nacos:
            server-addr: 192.168.10.210:8848
            dataId: ${spring.application.name}-authority-rules
            namespace: taotao-cloud-sentinel
            username: nacos
            password: nacos
            groupId: SENTINEL_GROUP
            data-type: json
            rule-type: authority
        #参数规则 名称随意
        param-flow:
          nacos:
            server-addr: 192.168.10.210:8848
            dataId: ${spring.application.name}-param-flow-rules
            namespace: taotao-cloud-sentinel
            username: nacos
            password: nacos
            groupId: SENTINEL_GROUP
            data-type: json
            rule-type: param-flow
      transport:
        dashboard: 192.168.10.210:8858
        port: 8712
      metric:
        file-single-size: 1024 * 1024 * 50
        file-total-count: 10
      flow:
        cold-factor: 3
      log:
        dir: ${user.home}/logs/${spring.application.name}/sentinel
        switch-pid: false
      scg:
        fallback:
          mode: response
          response-status: 200
          response-body: "{'data': null, 'code': 500,'message': '访问频繁,进入系统熔断'}"
