dependencies {
    implementation(project(':taotao-cloud-microservice:taotao-cloud-starter:taotao-cloud-starter-cloud')) {
        exclude group: "org.springframework", module: "spring-webmvc"
        exclude group: "com.alibaba.csp", module: "sentinel-spring-webmvc-adapter"
    }
    implementation(project(':taotao-cloud-microservice:taotao-cloud-starter:taotao-cloud-starter-redis')) {
        exclude group: "org.springframework", module: "spring-webmvc"
        exclude group: "com.alibaba.csp", module: "sentinel-spring-webmvc-adapter"
    }
    implementation(project(':taotao-cloud-microservice:taotao-cloud-starter:taotao-cloud-starter-log')) {
        exclude group: "org.springframework", module: "spring-webmvc"
        exclude group: "com.alibaba.csp", module: "sentinel-spring-webmvc-adapter"
    }
    implementation(project(':taotao-cloud-microservice:taotao-cloud-starter:taotao-cloud-starter-rule')) {
        exclude group: "org.springframework", module: "spring-webmvc"
        exclude group: "com.alibaba.csp", module: "sentinel-spring-webmvc-adapter"
    }

    implementation 'org.springframework.security:spring-security-core:5.4.2'
    implementation 'org.springframework.security:spring-security-config'
    implementation 'org.springframework.security:spring-security-oauth2-client'
    implementation 'org.springframework.security:spring-security-oauth2-resource-server'
    implementation 'org.springframework.security:spring-security-oauth2-jose'
    implementation 'com.nimbusds:nimbus-jose-jwt:8.16'

    implementation "org.springframework.boot:spring-boot-starter-webflux"
    implementation "org.springframework.cloud:spring-cloud-starter-loadbalancer"
    implementation("org.springframework.cloud:spring-cloud-starter-gateway") {
        exclude group: "org.springframework.boot", module: "spring-boot-starter-web"
        exclude group: "org.springframework.boot", module: "spring-boot-starter-webflux"
    }

    implementation 'com.alibaba.cloud:spring-cloud-starter-alibaba-nacos-discovery'
    implementation 'com.alibaba.cloud:spring-cloud-starter-alibaba-nacos-config'
    implementation 'com.alibaba.cloud:spring-cloud-alibaba-sentinel-gateway'
    implementation("com.alibaba.cloud:spring-cloud-starter-alibaba-sentinel") {
        exclude group: "com.fasterxml.jackson.dataformat", module: "jackson-dataformat-xml"
    }

    implementation 'org.springdoc:springdoc-openapi-webflux-ui:1.5.5'
    implementation 'org.springdoc:springdoc-openapi-webflux-core:1.5.5'
    implementation 'com.github.xiaoymin:knife4j-springdoc-ui:3.0.2'

    implementation "org.apache.commons:commons-pool2"
    implementation "org.apache.commons:commons-lang3"

    implementation "eu.bitwalker:UserAgentUtils"

    implementation 'org.projectlombok:lombok'
    annotationProcessor "org.projectlombok:lombok:${lombokVersion}"
    annotationProcessor "org.springframework.boot:spring-boot-configuration-processor:${springBootVersion}"

//    implementation "org.springframework.cloud:spring-cloud-starter-zipkin"
//    implementation "io.micrometer:micrometer-registry-prometheus"
}

configurations.all {
    exclude group: "org.springframework", module: "spring-webmvc"
    exclude group: "com.alibaba.csp", module: "sentinel-spring-webmvc-adapter"
}

springBoot {
    mainClassName = 'com.taotao.cloud.gateway.TaotaoCloudGatewayApplication'
    buildInfo {
        properties {
            artifact = 'zuul'
            version = '1.0.0'
            group = 'com.github.rep3.cloud'
            name = 'zuul'
        }
    }
}

bootJar {
//    zip64 true
    // jar包名称，默认是settings.gradle下的工程名 rootProject.name = 'alog-server'
//    baseName = 'taotao-cloud-gateway'
    classifier = null
    // jar包版本号
//    version =  '0.0.1'
    // 排除所有的jar
//    excludes = ["*.jar"]
    // lib目录的清除和复制任务
//    dependsOn copyJar
    // 配置目录的清除和复制任务
//    dependsOn copyConfigFile
//    dependencies {
//        exclude(dependency('org.springframework:spring-webmvc:*'))
//        exclude(dependency('com.alibaba.csp:sentinel-spring-webmvc-adapter:*'))
//    }


    mainClass = 'com.taotao.cloud.gateway.TaotaoCloudGatewayApplication'
    // 指定依赖包的路径
//    manifest {
//        attributes(
//                'Main-Class': "com.taotao.cloud.gateway.TaotaoCloudGatewayApplication"
//        )
//    }
}

shadowJar {
    zip64 true
    classifier = null
//    version = 1.0
    manifest {
        attributes(
                'Main-Class': "com.taotao.cloud.gateway.TaotaoCloudGatewayApplication"
        )
    }

    dependencies {
        exclude(dependency('org.springframework:spring-webmvc:.*'))
        exclude(dependency('com.alibaba.csp:sentinel-spring-webmvc-adapter:.*'))
        // exclude(dependency('xerces:xercesImpl:.*'))
        // exclude(dependency { it.moduleGroup == 'xml-apis' })
        // exclude(dependency { it.moduleGroup == 'org.apache.spark' })
        // exclude(dependency { it.moduleGroup == 'org.scala-lang' })
    }
}
