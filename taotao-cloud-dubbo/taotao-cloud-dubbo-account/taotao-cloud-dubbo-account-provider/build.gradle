archivesBaseName = 'taotao-cloud-dubbo-account-provider'

jar.enabled = true
bootJar.enabled = true

dependencies {
    implementation project(':taotao-cloud-dubbo:taotao-cloud-dubbo-account:taotao-cloud-dubbo-account-api')
    implementation project(':taotao-cloud-dubbo:taotao-cloud-dubbo-order:taotao-cloud-dubbo-order-api')

    implementation('org.springframework.boot:spring-boot-starter-web') {
        exclude group: "org.springframework.boot", module: "spring-boot-starter-tomcat"
    }
    implementation 'org.springframework.boot:spring-boot-starter-actuator'
    implementation 'org.springframework.boot:spring-boot-starter-undertow'

    implementation 'com.alibaba.cloud:spring-cloud-starter-alibaba-nacos-discovery'
    implementation 'com.alibaba.cloud:spring-cloud-starter-dubbo'

    implementation 'org.springframework.cloud:spring-cloud-starter-bootstrap'

    implementation 'mysql:mysql-connector-java'
    implementation 'com.baomidou:mybatis-plus-boot-starter'

    compileOnly 'org.projectlombok:lombok'
    annotationProcessor "org.projectlombok:lombok:${lombokVersion}"
}

bootJar {
    zip64 true
    // jar包名称，默认是settings.gradle下的工程名 rootProject.name = 'alog-server'
//    baseName = 'taotao-cloud-dubbo-account-provider'
    classifier = null

    mainClass = 'com.taotao.cloud.dubbo.account.provider.AccountServiceApplication'
    // 指定依赖包的路径
//    manifest {
//        attributes(
//                'Main-Class': "com.taotao.cloud.gateway.TaotaoCloudGatewayApplication"
//        )
//    }
}

jib {
    from {
        image = 'registry.cn-hangzhou.aliyuncs.com/taotao-cloud-decenter/taotao-cloud:openjdk8-jdk-alpine'
        auth {
            username System.getenv("TAOTAO_CLOUD_REGISTRY_USERNAME")
            password System.getenv("TAOTAO_CLOUD_REGISTRY_PASSWORD")
        }
    }
    allowInsecureRegistries=true
    to {
        image = 'registry.cn-hangzhou.aliyuncs.com/taotao-cloud-decenter/taotao-cloud'
        tags = ["${project.name}-${project.version}" ]
        auth {
            username System.getenv("TAOTAO_CLOUD_REGISTRY_USERNAME")
            password System.getenv("TAOTAO_CLOUD_REGISTRY_PASSWORD")
        }
    }
    container {
        creationTime = 'USE_CURRENT_TIMESTAMP'
        jvmFlags = ['-Djava.security.egd=file:/dev/./urandom', '-Dspring.profiles.active=dev', '-Dfile.encoding=utf-8', '-Duser.timezone=Asia/Shanghai']
        mainClass = 'com.taotao.cloud.dubbo.account.provider.AccountServiceApplication'
        args = ['some', 'args']
        ports = ['8010']
        labels = [key1:'value1', key2:'value2']
    }
}
